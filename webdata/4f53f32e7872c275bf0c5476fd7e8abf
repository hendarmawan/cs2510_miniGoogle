<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0045)http://www.cs.pitt.edu/~chang/163/c01/c01.htm -->
<HTML><HEAD><TITLE>Component-Based Software Engineering</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<META content="Microsoft FrontPage 5.0" name=GENERATOR></HEAD>
<BODY><a href="05.htm">
<IMG 
src="previous.gif" align=left width="26" height="26"></a>
<a href="../1631topic.html">
<IMG 
src="next.gif" align=right width="26" height="26"></a> 
<p class="MsoNormal"><font face="Courier New" color="#0000FF">//<i>Get 
the callers collection, which will allow us to examine everyone in the chain.</i></font></p>
<p class="MsoNormal"><i><font face="Courier New" color="#0000FF">// another 
method to get the number of caller in the chain</font></i><font color="#0000FF"><font face="Courier New"><br>
&nbsp;&nbsp;&nbsp;</font> <font face="Courier New">_variant_t Callers ;<br>
&nbsp;&nbsp; pCallCtx-&gt;get_Item (_bstr_t(&quot;Callers&quot;), &amp;Callers) ;<br>
<br>
&nbsp;&nbsp; ISecurityCallersColl *pCallersColl ;<br>
&nbsp;&nbsp; ((IUnknown *) Callers)-&gt;QueryInterface (IID_ISecurityCallersColl,&nbsp;<br>
&nbsp;&nbsp;&nbsp;</font>&nbsp;&nbsp;&nbsp;&nbsp; <font face="Courier New">(void **)&amp;pCallersColl) ;<br>
<br>
&nbsp;&nbsp; &nbsp;&nbsp; pCallersColl-&gt;get_Count (&amp;CallersCount) ;</font></font></p>
<pre class="syntax">&nbsp;</pre>
<p class="MsoNormal"><font face="Courier New" color="#0000FF">for (l = 0 ; l &lt; 
CallersCount ; l++)<br>
{ </font></p>
<p class="MsoNormal"><font face="Courier New" color="#0000FF"><i>/*<br>
For each caller in the chain, get the account name.<br>
*/<br>
</i><br>
&nbsp;&nbsp;&nbsp; ISecurityIdentityColl *pSecIdentColl ;<br>
&nbsp;&nbsp; pCallersColl-&gt;get_Item (l, &amp;pSecIdentColl) ;</font></p>
<p class="MsoNormal"><font face="Courier New" color="#0000FF">&nbsp;&nbsp;&nbsp; _variant_t 
ThisAccountName ;<br>
&nbsp;&nbsp;&nbsp; pSecIdentColl-&gt;get_Item (_bstr_t (&quot;AccountName&quot;), &amp;ThisAccountName) 
;</font></p>
<p class="MsoNormal"><font face="Courier New" color="#0000FF">&nbsp;&nbsp;&nbsp; 
Display (&quot;The l th AccountName is: &quot;,ThisAccountName);</font></p>
<p class="MsoNormal"><font color="#0000FF">} </font></p>
<pre class="syntax">&nbsp;</pre>
<pre class="syntax"><font face="Courier New" size="3">Code Explain:</font></pre>
<table class="data">
  <tr vAlign="top">
    <th class="data" align="left" width="22%">Item</th>
    <th class="data" align="left" width="26%">Description</th>
    <th class="data" align="left" width="26%">Index name</th>
    <th class="data" align="left" width="26%">Returned type</th>
  </tr>
  <tr vAlign="top">
    <td class="data" width="22%">SID</td>
    <td class="data" width="26%">The security identifier of the caller. </td>
    <td class="data" width="26%">&quot;SID&quot;</td>
    <td class="data" width="26%">V_ARRAY</td>
  </tr>
  <tr vAlign="top">
    <td class="data" width="22%">Account Name</td>
    <td class="data" width="26%">The account name that the caller is using. </td>
    <td class="data" width="26%">&quot;AccountName&quot;</td>
    <td class="data" width="26%">V_BSTR</td>
  </tr>
  <tr vAlign="top">
    <td class="data" width="22%">Authentication Service</td>
    <td class="data" width="26%">The authentication service used by the caller, 
    such as NTLMSSP, Kerberos, or SSL. </td>
    <td class="data" width="26%">&quot;AuthenticationService&quot;</td>
    <td class="data" width="26%">V_I4</td>
  </tr>
  <tr vAlign="top">
    <td class="data" width="22%">Impersonation Level</td>
    <td class="data" width="26%">The impersonation level, which indicates how 
    much authority the caller has been given to act on a client's behalf. </td>
    <td class="data" width="26%">&quot;ImpersonationLevel&quot;</td>
    <td class="data" width="26%">V_I4</td>
  </tr>
  <tr vAlign="top">
    <td class="data" width="22%">Authentication Level</td>
    <td class="data" width="26%">The authentication level used by the caller, 
    which indicates the amount of protection given during the call. </td>
    <td class="data" width="26%">&quot;AuthenticationLevel&quot;</td>
    <td class="data" width="26%">V_I4</td>
  </tr>
</table>
<pre class="syntax"><font size="3" face="Times New Roman">The <b>ISecurityCallersColl</b> provides access to information about individual callers in a collection of callers</font></pre>
<pre class="syntax">&nbsp;</pre>
<p class="MsoNormal">You can feed the AccountName to the method 
ISecurityCallContext::IsUserInRole( ) to find out if any of the intervening 
callers belonged (or didn't belong) to the role that you wanted (or didn't 
want).&nbsp; Or you can use the SID of anyone in the call chain that you care about 
if you want to do any really hairy NT security stuff, .&nbsp;&nbsp; </p>

<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">A
<a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/htm/cmf_a2c_2rqs.asp">
link to msdn library</a></p>

<p>&nbsp;&nbsp;&nbsp; </p>

</BODY></HTML>
